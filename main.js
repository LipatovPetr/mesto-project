(()=>{"use strict";var e={},t=document.querySelector(".profile__name"),n=document.querySelector(".profile__title"),o=document.querySelector(".profile__avatar"),r=document.querySelectorAll(".popup"),c=document.querySelector(".popup__profile"),a=document.getElementById("profile-form"),i=document.querySelector(".profile-popup__container"),s=document.getElementById("profile-name-input"),u=document.getElementById("profile-occupation-input"),l=document.querySelector(".profile__edit-button"),d=document.querySelector(".popup__close-icon"),m=document.querySelector(".profile-form__button"),f=document.querySelector(".popup__cards"),_=document.querySelector(".profile__add-button"),p=document.querySelector(".popup-cards__close-icon"),v=document.getElementById("cards-form"),h=document.getElementById("card-title-input"),y=document.getElementById("card-link-input"),S=document.querySelector(".card-popup__container"),E=document.querySelector(".card-form__button"),b=document.querySelector(".popup__avatar"),k=document.querySelector(".avatar-popup__container"),L=document.querySelector(".avatar__close-icon"),q=document.getElementById("avatar-form"),g=document.getElementById("avatar-link-input"),C=document.querySelector(".avatar-form__button"),B=(document.querySelector(".elements__element"),document.getElementById("card-template").content),j=document.getElementById("elements-container"),x=document.querySelector(".photo-popup"),P=x.querySelector(".photo-popup__image"),I=x.querySelector(".photo-popup__subtitle"),U=document.querySelector(".photo-popup__close-icon"),A=document.querySelector(".photo-popup__container"),T={formSelector:".form",inputSelector:".form__item",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_inactive",inputErrorClass:"form__item_error",errorClass:"form__error-text_active"},w={baseUrl:"https://nomoreparties.co/v1/plus-cohort-19",headers:{authorization:"c061e49c-1434-49b8-869d-f52e38c6e093","Content-Type":"application/json"}};function D(e,t,n,o,r){var c=B.querySelector(".elements__element").cloneNode(!0),a=c.querySelector(".elements__image"),i=c.querySelector(".elements__title"),s=c.querySelector(".elements__likes-value");return i.textContent=e,s.textContent=n,a.alt=e,a.src=t,c.dataset.ownerId=o,c.dataset.cardId=r,c.querySelector(".elements__heart-button").addEventListener("click",M),a.addEventListener("click",F),c}function N(t,n,o){var r=t.querySelector(".elements__heart-button");n.prepend(t),function(t){var n=t.querySelector(".elements__remove-button");!function(t){return e.id===t.dataset.ownerId}(t)?n.classList.remove("elements__remove-button_active"):(n.classList.add("elements__remove-button_active"),n.addEventListener("click",(function(){!function(e){fetch("".concat(w.baseUrl,"/cards/").concat(e.dataset.cardId),{method:"DELETE",headers:w.headers})}(t)})),n.addEventListener("click",O))}(t),function(e,t){t?e.classList.add("elements__heart-button_active"):e.classList.remove("elements__heart-button_active")}(r,o)}function O(e){e.target.closest(".elements__element").remove()}function J(e){console.log(e)}function M(t){var n=t.target.closest(".elements__element").getAttribute("data-card-id");return fetch("".concat(w.baseUrl,"/cards"),{headers:w.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(o){o.find((function(e){return e._id===n})).likes.some((function(t){return t._id===e.id}))?function(e,t){e.target.classList.remove("elements__heart-button_active"),fetch("".concat(w.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:w.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(t){e.target.nextElementSibling.textContent=t.likes.length})).catch((function(e){J("Ошибка: ".concat(e))}))}(t,n):function(e,t){e.target.classList.add("elements__heart-button_active"),fetch("".concat(w.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:w.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(t){e.target.nextElementSibling.textContent=t.likes.length})).catch((function(e){J("Ошибка: ".concat(e))}))}(t,n)})).catch((function(e){J("Ошибка: ".concat(e))}))}function H(e){"Escape"===e.key&&z(document.querySelector(".popup_opened"))}function V(e){e.classList.add("popup_opened"),document.addEventListener("keydown",H)}function z(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",H)}function F(e){var t=e.target.closest(".elements__element");P.src=t.querySelector(".elements__image").src,I.textContent=t.querySelector(".elements__title").textContent,V(x)}fetch("".concat(w.baseUrl,"/users/me"),{headers:w.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(r){var c;c=r,t.textContent=c.name,n.textContent=c.about,o.src=c.avatar,e.id=c._id})).catch((function(e){J("Ошибка: ".concat(e))})),fetch("".concat(w.baseUrl,"/cards"),{headers:w.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(t){t.forEach((function(t){var n=t.likes.some((function(t){return t._id===e.id}));N(D(t.name,t.link,t.likes.length,t.owner._id,t._id),j,n)}))})).catch((function(e){J("Ошибка: ".concat(e))}));var G,K=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))};o.addEventListener("click",(function(){V(b)})),L.addEventListener("click",(function(){z(b)})),k.addEventListener("click",(function(e){e.stopPropagation()})),q.addEventListener("submit",(function(e){var t;e.preventDefault(),t=g.value,fetch("https://nomoreparties.co/v1/plus-cohort-19/users/me/avatar",{method:"PATCH",headers:w.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){o.src=e.avatar})).catch((function(e){J("Ошибка: ".concat(e))})),z(b),q.reset(),C.disabled=!0,C.classList.add(T.inactiveButtonClass)})),l.addEventListener("click",(function(){V(c)})),l.addEventListener("click",(function(){s.value=t.textContent,u.value=n.textContent,m.disabled=!0,m.classList.add(T.inactiveButtonClass)})),d.addEventListener("click",(function(){z(c)})),a.addEventListener("submit",(function(e){var o,r;e.preventDefault(),o=s.value,r=u.value,fetch("".concat(w.baseUrl,"/users/me"),{method:"PATCH",headers:w.headers,body:JSON.stringify({name:o,about:r})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){t.textContent=e.name,n.textContent=e.about})).catch((function(e){J("Ошибка: ".concat(e))})),z(c)})),i.addEventListener("click",(function(e){e.stopPropagation()})),_.addEventListener("click",(function(){V(f)})),p.addEventListener("click",(function(){z(f)})),v.addEventListener("submit",(function(e){var t,n;e.preventDefault(),t=h.value,n=y.value,fetch("".concat(w.baseUrl,"/cards"),{method:"POST",headers:w.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){N(D(e.name,e.link,e.likes.length,e.owner._id,e._id),j)})).catch((function(e){J("Ошибка: ".concat(e))})),z(f),v.reset(),E.disabled=!0,E.classList.add(T.inactiveButtonClass)})),S.addEventListener("click",(function(e){e.stopPropagation()})),U.addEventListener("click",(function(){z(x)})),A.addEventListener("click",(function(e){e.stopPropagation()})),r.forEach((function(e){return e.addEventListener("click",(function(){z(e)}))})),G=T,Array.from(document.querySelectorAll(G.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);K(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),K(n,o,t)}))}))}(e,G)}))})();